<!DOCTYPE html>
<html>

    <head>
        <script src="https://cdn.jsdelivr.net/gh/tuftsceeo/SPIKE-Web-Interface@1.1.0/cdn/ServiceDock_scaled.min.js"></script>
    </head>

    <body>
        <div>
            <service-spike id="service_spike"></service-spike>
            <button id ="test" style = "height: 300px; width: 300px;"></button>
        </div>
    </body>
    <script>
        document.getElementById("test").addEventListener("click", async () => {
            navigator.usb.requestDevice({ filters: [{}] })
                .then(async (device) => {
                    await device.reset();
                    console.log("done resetting USB device");
                    console.log(device.productName);      // LEGO Technic Large Hub in FS Mode
                    console.log(device.manufacturerName); // LEGO System A/S
                    console.log(device.configuration);   
                    console.log(device.deviceProtocol);  // 0
                    
                    // print paired devices
                    navigator.usb.getDevices()
                    .then(devices => {
                          console.log("Total devices: " + devices.length);
                        devices.forEach(device => {
                            console.log("Product name: " + device.productName + ", serial number " + device.serialNumber);
                        });
                    })

                    await device.open();
                    console.log("done opening usb device")
                    await device.selectConfiguration(1);
                    console.log("done selecting config")
                    await device.claimInterface(device.configuration.interfaces[0].interfaceNumber);
                    console.log("done claiming interface")

                    // device.open()
                    // .then(() => {
                            // console.log("here")
                        // })
                    // .catch( (err) => {
                        // console.error(err);
                    // })
                })
                .catch(error => { 
                    console.error(error); 

                })
        })
        
        navigator.usb.addEventListener('connect', event => {
            // Add event.device to the UI.
            console.log("connected")
            console.log(event.device)
        });

        navigator.usb.addEventListener('disconnect', event => {
            // Remove event.device from the UI.
            console.log("disconnected")
            console.log(event.device)
        });


    </script>
</html>